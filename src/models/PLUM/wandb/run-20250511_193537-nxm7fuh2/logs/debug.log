2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Current SDK version is 0.16.0
2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Configure stats pid to 2160423
2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Loading settings from /home/jk100/.config/wandb/settings
2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Loading settings from /shared/nas2/jk100/partonomy_private/src/models/PLUM/wandb/settings
2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Loading settings from environment variables: {}
2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Applying setup settings: {'_disable_service': False}
2025-05-11 19:35:37,218 INFO    MainThread:2160423 [wandb_setup.py:_flush():76] Inferring run settings from compute environment: {'program_relpath': 'src/models/PLUM/plum_train_ds.py', 'program_abspath': '/shared/nas2/jk100/partonomy_private/src/models/PLUM/plum_train_ds.py', 'program': '/shared/nas2/jk100/partonomy_private/src/models/PLUM/plum_train_ds.py'}
2025-05-11 19:35:37,219 INFO    MainThread:2160423 [wandb_init.py:_log_setup():524] Logging user logs to /shared/nas2/jk100/partonomy_private/src/models/PLUM/wandb/run-20250511_193537-nxm7fuh2/logs/debug.log
2025-05-11 19:35:37,219 INFO    MainThread:2160423 [wandb_init.py:_log_setup():525] Logging internal logs to /shared/nas2/jk100/partonomy_private/src/models/PLUM/wandb/run-20250511_193537-nxm7fuh2/logs/debug-internal.log
2025-05-11 19:35:37,219 INFO    MainThread:2160423 [wandb_init.py:init():564] calling init triggers
2025-05-11 19:35:37,219 INFO    MainThread:2160423 [wandb_init.py:init():571] wandb.init called with sweep_config: {}
config: {'local_rank': 0, 'version': 'liuhaotian/llava-llama-2-13b-chat-lightning-preview', 'zero_shot_ckpt_path': 'runs/plum-13b_kld_0.1_focal_tversky_8_v1_0shot/plum-13b_kld_0.1_focal_tversky_8_v1_0shot_bidirbio_2048_accum_10_maxlen512_epochs25_segloss_2_bce_loss_2_kld_loss_0_dice_loss_8_bidir_bio_train_prompt_enc_ckpt_model', 'vis_save_path': './vis_output', 'precision': 'bf16', 'image_size': 1024, 'model_max_length': 512, 'lora_r': 8, 'vision_tower': 'openai/clip-vit-large-patch14', 'load_in_8bit': False, 'load_in_4bit': False, 'dataset': 'explanatory_seg', 'sample_rates': '1', 'sem_seg_data': 'ade20k||cocostuff||pascal_part||paco_lvis||mapillary', 'refer_seg_data': 'refclef||refcoco||refcoco+||refcocog', 'explanatory_seg_data': True, 'wandb': False, 'wandb_project_name': 'plum-training', 'vqa_data': 'llava_instruct_150k', 'reason_seg_data': 'ReasonSeg|train', 'val_dataset': 'ReasonSeg|val', 'dataset_dir': '/shared/nas/data/m1/jk100/code/OpenAttrLibrary/LISA/dataset', 'partonomy_train_dataset_path': '/shared/nas2/blume5/sp25/partonomy/partonomy_private/data/partonomy_descriptors/{dataset_split}/{dataset_split}_qa_pairs_train.json', 'partonomy_val_dataset_path': '/shared/nas2/blume5/sp25/partonomy/partonomy_private/data/partonomy_descriptors/{dataset_split}/{dataset_split}_qa_pairs_val.json', 'partonomy_dataset_split': 'partimagenet', 'partonomy_question_type': 'identification_with_label', 'sample_one_question_per_image': True, 'random_seed': 42, 'metrics.macro_giou_evaluator_config': IoUEvaluatorConfig(matching_strategy=<MatchingStrategy.PAIRED: 'paired'>, reduction='macro'), 'metrics.micro_giou_evaluator_config': IoUEvaluatorConfig(matching_strategy=<MatchingStrategy.PAIRED: 'paired'>, reduction='micro'), 'metrics.part_text_evaluator_config': PartTextEvaluatorConfig(match_method=<MatchingStrategy.EXACT: 'exact'>, embedding_model='google-bert/bert-base-uncased', cosine_threshold=0.75, embedding_device='cuda', embedding_matching_algorithm='hungarian', llm_model='microsoft/Phi-4-mini-instruct', llm_temperature=0, max_tokens=100, vllm_gpu_memory_utilization=1.0), 'log_base_dir': './runs', 'exp_name': 'plum-13b_kld_0.1_focal_tversky_8_v1_partonomy_ft', 'epochs': 20, 'steps_per_epoch': 500, 'batch_size': 6, 'grad_accumulation_steps': 10, 'val_batch_size': 1, 'workers': 4, 'lr': 0.0003, 'ce_loss_weight': 1.0, 'dice_type': 'focal_tversky', 'dice_loss_weight': 8.0, 'dice_scale_factor': 1000.0, 'bce_loss_weight': 2.0, 'kld_loss_weight': 0.1, 'kld_sigma': 1.0, 'seg_cls_loss_weight': 2.0, 'seg_cls_loss_per_cls_weight': [0.1, 1.0, 1.0], 'use_teacher_ref': False, 'use_bidir_bio': True, 'use_cross_attn_bio': False, 'use_hinge_loss': False, 'use_crf_bio': False, 'pred_binary_span': False, 'focal_tversky_alpha': 0.3, 'focal_tversky_beta': 0.7, 'limit_batches': 10, 'use_feedback_loop': True, 'bidir_nhead': 8, 'bidir_dim_feedforward': 2048, 'lora_alpha': 16, 'lora_dropout': 0.05, 'lora_target_modules': 'q_proj,v_proj', 'explanatory': 0.1, 'beta1': 0.9, 'beta2': 0.95, 'num_classes_per_sample': 5, 'exclude_val': False, 'no_eval': False, 'eval_only': False, 'vision_pretrained': '/shared/nas/data/m1/jk100/code/OpenAttrLibrary/LISA/weights/sam_vit_h_4b8939.pth', 'out_dim': 256, 'resume': '', 'print_freq': 1, 'start_epoch': 0, 'gradient_checkpointing': True, 'train_mask_decoder': True, 'train_mask_prompt_encoder': True, 'use_mm_start_end': True, 'auto_resume': True, 'conv_type': 'llava_v1', 'log_dir': './runs/plum-13b_kld_0.1_focal_tversky_8_v1_partonomy_ft'}
2025-05-11 19:35:37,219 INFO    MainThread:2160423 [wandb_init.py:init():614] starting backend
2025-05-11 19:35:37,219 INFO    MainThread:2160423 [wandb_init.py:init():618] setting up manager
2025-05-11 19:35:37,220 INFO    MainThread:2160423 [backend.py:_multiprocessing_setup():105] multiprocessing start_methods=fork,spawn,forkserver, using: spawn
2025-05-11 19:35:37,222 INFO    MainThread:2160423 [wandb_init.py:init():624] backend started and connected
2025-05-11 19:35:37,224 INFO    MainThread:2160423 [wandb_init.py:init():716] updated telemetry
2025-05-11 19:35:37,234 INFO    MainThread:2160423 [wandb_init.py:init():749] communicating run to backend with 90.0 second timeout
2025-05-11 19:35:37,351 ERROR   MainThread:2160423 [wandb_init.py:init():1194] error
Traceback (most recent call last):
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 1166, in init
    run = wi.init()
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/sdk/wandb_init.py", line 751, in init
    run_init_handle = backend.interface.deliver_run(run)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/sdk/interface/interface.py", line 710, in deliver_run
    run_record = self._make_run(run)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/sdk/interface/interface.py", line 140, in _make_run
    self._make_config(data=config_dict, obj=proto_run.config)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/sdk/interface/interface.py", line 122, in _make_config
    update.value_json = json_dumps_safer(json_friendly(v)[0])
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/util.py", line 828, in json_dumps_safer
    return dumps(obj, cls=WandBJSONEncoder, **kwargs)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/site-packages/wandb/util.py", line 779, in default
    return json.JSONEncoder.default(self, obj)
  File "/shared/nas/data/m1/jk100/.conda/envs/llava/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type MatchingStrategy is not JSON serializable
2025-05-11 19:35:38,395 WARNING MsgRouterThr:2160423 [router.py:message_loop():77] message_loop has been closed
